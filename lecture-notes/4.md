---
sidebar_position: 4
lecture_number: 4
title: Lecture 4 - Functions
---

### This starts to introduce function design recipe -- type annotations, doc string, but NO tests.

## Outcomes: [1.1](/outcomes/#(1.1))
 
## From Repeated Code to Custom Functions

### **Lecture Objectives**
- Understand how to capture repeated expressions as functions.
- Introduce the first two parts of function design recipe: type annotations & doc string

---

### **I. Introduction & Motivation (5 minutes)**
- **Overview:**
  Today we will learn how to capture repeated patterns in functions. 

---

### **II. Creating Functions By Abstraction (20 minutes)**
#### **A. Example 1: Three-Tier Cake Image**
- **Scenario:**
  Suppose we want to draw images of three-tier cakes. Each cake consists of three equally sized rectangular layers, and the only difference is the color (or "flavor") of each layer.

- **Repeated Expressions (Without a Function):**
  ```pyret
  LAYER-WIDTH = 120
  LAYER-HEIGHT = 30
  # Cake 1 (Chocolate, Vanilla, Strawberry)
  frame(
    above(rectangle(LAYER-WIDTH, LAYER-HEIGHT, "solid", "brown"),
      above(rectangle(LAYER-WIDTH, LAYER-HEIGHT, "solid", "white"),
        rectangle(LAYER-WIDTH, LAYER-HEIGHT, "solid", "pink"))))

  # Cake 2 (Lemon, Blueberry, Mint)
  frame(
    above(rectangle(LAYER-WIDTH, LAYER-HEIGHT, "solid", "yellow"),
      above(rectangle(LAYER-WIDTH, LAYER-HEIGHT, "solid", "blue"),
        rectangle(LAYER-WIDTH, LAYER-HEIGHT, "solid", "green"))))
  ```
- **Transition to a Function:**
  Identify the fixed parts (the dimensions, the stacking with `above`, the frame) and the changing parts (the colors). Replace the changing parts with function arguments / parameters:

- **Basic Function Definition:**
  ```pyret
  LAYER-WIDTH = 120
  LAYER-HEIGHT = 30
  fun three-tier-cake(top, middle, bottom):
    frame(
      above(rectangle(LAYER-WIDTH, LAYER-HEIGHT, "solid", top),
        above(rectangle(LAYER-WIDTH, LAYER-HEIGHT, "solid", middle),
          rectangle(LAYER-WIDTH, LAYER-HEIGHT, "solid", bottom))))
  end
  ```
- **Live Demo:**
  - Enter the above function definition in the definitions pane.
  - Then hit Run and write the following in the interactions:
    ```pyret
    three-tier-cake("brown", "white", "pink")
    three-tier-cake("yellow", "blue", "green")
    ```
  - **Discussion:**
    Explain how the function body is reused with different inputs, and show that the output images match the desired cakes.
  
  - **Program Directory Model**
    Function definitions work by adding to the program directory entries for the
    function arguments, and running the body with that extended directory.
  
    Draw out program directory, showing how it changes as both of the above
    examples are run. It start with the two constants, gains three local
    variables, runs body first time, then resets to just constants, then has new
    set of local variables, runs body second time.

#### **B. Example 2: T-shirt Cost Calculation**
- **Scenario:**
  Consider a scenario where a t-shirt costs \$5.00 plus an extra \$0.10 per character in a slogan.

- **Repeated Expressions:**
  ```pyret
  PER-SHIRT = 5.00
  PER-CHAR = 0.10
  # Ordering 4 t-shirts with "Go Team!"
  4 * (PER-SHIRT + (string-length("Go Team!") * PER-CHAR))

  # Ordering 7 t-shirts with "Hello World"
  7 * (PER-SHIRT + (string-length("Hello World") * PER-CHAR))
  ```
- **Transition to a Function:**
  Here, the fixed part is the pricing structure (base price and per-character fee) while the number of shirts and the slogan are the parameters.

- **Basic Function Definition:**
  ```pyret
  PER-SHIRT = 5.00
  PER-CHAR = 0.10
  fun tshirt-cost(num-shirts, slogan):
    num-shirts * (PER-SHIRT + (string-length(slogan) * PER-CHAR))
  end
  ```
- **Live Demo:**
  - Add this function definition to the definitions pane.
  - Then, in the interactions pane, try:
    ```pyret
    tshirt-cost(4, "Go Team!")
    tshirt-cost(7, "Hello World")
    tshirt-cost(0, "Any Slogan")
    tshirt-cost(5, "")
    ```

- **Exercise**

  - Have students walk through what happens with the program directory across these calls. 
---

### **III. From Defining Functions to Designing Functions (15 minutes)**
#### **A. Observing Potential Issues**
- **Error Scenario:**
  Ask: "What might happen if we accidentally call `three-tier-cake` with a non-string value?"
  For example:
  ```pyret
  three-tier-cake(123, "white", "pink")
  ```
- **Discussion:** Without type annotations, the error messages refer to
  lower-level operations (e.g., `rectangle(LAYER-WIDTH, LAYER-HEIGHT, "solid", 123)`), which can
  be confusing. It is also harder for someone who reads the code to know what it
  should do! This motivates the need for type annotations to not only catch
  errors earlier, but to express the programmers **intent** -- this is our first
  encounter with the idea of **design** -- while programs without type
  annotations will potentially work, programs with annotations will be clearer /
  easier to understand, easier to modify, and even easier to write in the first place!

#### **B. Functions Should Describe Type of Arguments, And What They Do!**
- **Designed Three-Tier Cake Function:**
  ```pyret
  LAYER-WIDTH = 120
  LAYER-HEIGHT = 30
  fun three-tier-cake(top :: String,
      middle :: String,
      bottom :: String) -> Image:
   doc: "produces an image of three rectangles, with colors corresponding to inputs"
   frame(
      above(rectangle(LAYER-WIDTH, LAYER-HEIGHT, "solid", top),
        above(rectangle(LAYER-WIDTH, LAYER-HEIGHT, "solid", middle),
          rectangle(LAYER-WIDTH, LAYER-HEIGHT, "solid", bottom))))
  end
  ```
  - **Live Demo:**
    Run the previous erroneous example, see different error.
    
    Note how doc string helps someone understand what the intention of function
    is, without, or before, looking at actual code. Other important
    communication in natural language (e.g., English) are the names of the
    functions and the names of the parameters!

- **Designed T-shirt Cost Function:**
  ```pyret
  PER-SHIRT = 5.00
  PER-CHAR = 0.10
  fun tshirt-cost(num-shirts :: Number, slogan :: String) -> Number:
    doc: "calculates a total cost of shirts, which are $5 per plus $0.10 per character of slogan"
    num-shirts * (5.00 + (string-length(slogan) * 0.10))
  end
  ```
  - **Live Demo:**
    Update the t-shirt function definition in the definitions pane. Then, intentionally call:
    ```pyret
    tshirt-cost("four", "Go Team!")
    ```
    Ask: "What does the error message now tell us?"
    

#### **C. Reason for Design**
- **Key Points:**
  - Type annotations serve as a form of documentation to explain what kind of input each parameter expects.
  - Doc strings communicate what the function does, in a clear, simple way. 
  - These serve both as a guide to others, but more importantly, as a guide to
    YOU! As thinking through the inputs / outputs **before** writing the
    function, and describing what the function should do, helps you figure out how to implement it.

